
pkgbase=projectm
pkgname=('projectm' 'projectm-pulseaudio' 'projectm-qt')
pkgver=3.1.0
pkgrel=1
arch=('x86_64')
url='https://github.com/projectM-visualizer/projectm/'
license=('LGPL')
makedepends=('cmake' 'mesa' 'qt5-base' 'ftgl' 'glew' 'libvisual' 'libxext' 'pulseaudio' 'glm' 'sdl2')
source=("https://github.com/projectM-visualizer/$pkgname/archive/v$pkgver.tar.gz")
sha256sums=('8ddf99dc141e554d76a2ecf8d8c1fe7996051e30fa8dd4fc133ce024c8defba7')


build() {
  
  cd $pkgname-$pkgver
  
  ./autogen.sh
  ./configure \
     --prefix=/usr \
     --enable-qt \
     --enable-sdl
  make
  
}

package_projectm() {
  pkgdesc='Music visualizer which uses 3D accelerated iterative image based rendering'
  depends=('ftgl' 'glew' 'libgl' 'sdl2')

  cd $pkgbase-$pkgver
  
  for dirs in src/{libprojectM,NativePresets}; do
    make -C "$dirs" DESTDIR=$pkgdir install
  done
}

# package_projectm-libvisual() {
#   pkgdesc='ProjectM plugin for XMMS'
#   depends=('projectm' 'libvisual' 'gcc-libs')
#   replaces=('libvisual-projectm')
#   provides=('libvisual-projectm')
#   
#   cd $pkgbase-$pkgver/src/projectM-libvisual
#   make DESTDIR=$pkgdir install
# }

package_projectm-pulseaudio() {
  pkgdesc='ProjectM support for Pulseaudio'
  depends=('projectm-qt' 'pulseaudio')
  
  cd $pkgbase-$pkgver/src/projectM-pulseaudio
  make DESTDIR=$pkgdir install
}

# package_projectm-jack() {
#   pkgdesc='ProjectM support for Jack'
#   depends=('projectm-qt' 'jack')
#   
#   cd $pkgbase-$pkgver/src/projectM-jack
#   make DESTDIR=$pkgdir install
# }

package_projectm-qt() {
  pkgdesc='Qt5 bindings for ProjectM'
  depends=('projectm' 'qt5-base' 'libgl')
  
  cd $pkgbase-$pkgver/src/projectM-qt
  make DESTDIR=$pkgdir install
}

# package_projectm-test() {
#   pkgdesc='ProjectM test applications'
#   depends=('projectm' 'sdl2' 'libgl')
#   
#   cd $pkgbase-$pkgver/src/projectM-test
#   make DESTDIR=$pkgdir install
# }
