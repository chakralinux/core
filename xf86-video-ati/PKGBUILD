#
# Platform Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=xf86-video-ati
pkgver=6.14.0.99
pkgrel=1
pkgdesc="X.org ati video driver"
arch=(i686 x86_64)
url="http://xorg.freedesktop.org/"
license=('custom')
depends=(libpciaccess libdrm udev pixman ati-dri)
makedepends=('xorg-server' 'libdrm' 'xf86driproto' 'mesa')
conflicts=('xorg-server<1.10.0')
groups=('xorg-video-drivers')
options=('!libtool')
source=(${url}/releases/individual/driver/${pkgname}-${pkgver}.tar.bz2)
source=("http://chakra-project.org/sources/${pkgname}/${pkgname}-${pkgver}-${pkgrel}.tar.xz")
md5sums=("f2651e27aed68807218b73fa13a203c9") #  xf86-video-ati-6.14.0.99-1.tar.xz
#md5sums=('b64bf8939f9f8fb518baf858f8b6ca73')

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf ${pkgname}
	  git clone git://anongit.freedesktop.org/xorg/driver/xf86-video-ati
	  rm -vRf ${pkgname}/.git
	  pushd ${pkgname}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}-${pkgrel}.tar.xz ${pkgname}/*
	  md5sum ${pkgname}-${pkgver}-${pkgrel}.tar.xz
}

build() 

{ 
    cd ${srcdir}/

    msg "Starting make for: ${pkgname}"
    
    cd ${srcdir}/${pkgname}
#    cd ${srcdir}/${pkgname}-${pkgver}
        
    msg "Starting configure..."

    autoreconf -v --install
    
    ./configure \
            --prefix=/usr \
            --enable-maintainer-mode \
            --enable-dependency-tracking \
            --enable-exa \
            --enable-dri
    
    msg "Starting make..."
    make V=1
}

package()

{
    cd ${srcdir}/${pkgname}
#    cd ${srcdir}/${pkgname}-${pkgver}
    make DESTDIR=${pkgdir} install 
 
    msg "Copying license..."
    install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
    install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}/"
}