#
# Core packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=ca-certificates
pkgver=20110502
_debpkgver="${pkgver}+nmu1"
pkgrel=3
pkgdesc='Common CA certificates'
arch=('any')
url='http://packages.qa.debian.org/c/ca-certificates.html'
license=('MPL' 'GPL')
source=("http://ftp.debian.org/debian/pool/main/c/${pkgname}/${pkgname}_${_debpkgver}.tar.gz")
depends=('bash' 'run-parts' 'openssl' 'findutils' 'coreutils' 'sed')
makedepends=('ruby' 'python2')
install=ca-certificates.install
backup=('etc/ca-certificates.conf')
md5sums=('13aed718a5cdd05b4086c93dafd4e1e2')

build() {
  cd "${srcdir}/${pkgname}-${_debpkgver}"

  sed 's|/usr/bin/python|/usr/bin/python2|g' -i mozilla/certdata2pem.py
  sed 's|python|python2|g' -i mozilla/Makefile
  make
}

package() {
  cd "${srcdir}/${pkgname}-${_debpkgver}"

  install -d -m755 "${pkgdir}"/{etc/ca-certificates/update.d,usr/{sbin,share/ca-certificates},etc/ssl/certs}
  make install DESTDIR="${pkgdir}"
  install -D -m644 sbin/update-ca-certificates.8 "${pkgdir}/usr/share/man/man8/update-ca-certificates.8"

  (
    echo "# Automatically generated by ${pkgname}-${pkgver}-${pkgrel}"
    echo "# see update-ca-certificates man page"
    echo "# "
    cd ${pkgdir}/usr/share/ca-certificates
    find . -name '*.crt' | sort | cut -b3-
  ) > ${pkgdir}/etc/ca-certificates.conf
}

# vim:set ts=2 sw=2 et:
