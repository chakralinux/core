#
# Platform Packages for Chakra, part of chakra-project.org
#
# contributor (x86_64): Giuseppe Cal√† <jiveaxe@gmail.com>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=burg-emu
pkgver=1844
pkgrel=1
pkgdesc="A brand-new boot loader based on GRUB.(emu)"
url="https://launchpad.net/burg"
license="GPL3"
arch=('i686' 'x86_64')
depends=('ruby' 'python' 'gettext' 'freetype2' 'sdl' 'ncurses' )
makedepends=('bzr')
optdepens=('burg-bzr')
provides=('burg-emu')
install='burg-emu.install'

_bzrmod=burg
_bzrtrunk=lp:${_bzrmod}

build() {
 cd $srcdir/

msg "Connecting to the server...."
  if [ ! -d ./${_bzrmod} ]; then
   bzr branch ${_bzrtrunk} -r ${pkgver}
    else
   cd ${_bzrmod} && bzr pull -r ${pkgver}
  fi
  msg "BZR checkout done or server timeout"
  cd "${srcdir}/${_bzrmod}"
  ## Archlinux changed default /usr/bin/python to 3.1.2, need to use /usr/bin/python2 instead
  sed -i 's|python|python2|' ${srcdir}/${_bzrmod}/autogen.sh
 ./autogen.sh || return 1
}
package() {
provides=('burg-emu')
install='burg-emu.install'
msg "Removing old build directory..."
rm -rf $srcdir/$_bzrmod-emu-build
msg "Creating build directory..."
mkdir $srcdir/$_bzrmod-emu-build
cd $srcdir/$_bzrmod-emu-build
$srcdir/$_bzrmod/configure --with-platform=emu --disable-grub-emu-usb --prefix=/opt/burg-emu  || return 1
make || return 1
make install DESTDIR=$pkgdir || return 11
}
