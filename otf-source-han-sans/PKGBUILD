pkgbase=otf-source-han-sans
pkgname=($pkgbase $pkgbase-k $pkgbase-sc $pkgbase-tc ${pkgbase/otf/otc})
pkgver=1.002
pkgrel=1
pkgdesc='Adobe Source Han Sans - A set of Pan-CJK fonts designed to complement Source Sans Pro'
arch=('any')
license=('custom:OFL')
url='http://sourceforge.net/adobe/source-han-sans'
depends=('fontconfig')
install="${pkgbase}.install"
source=()

_commit=92a7a61a726dbd01298bc6a19c6d946aa32fee1e
_weights=("Bold" "ExtraLight" "Heavy" "Light" "Medium" "Normal" "Regular")
_font=("OTC SourceHanSans ttc ${pkgbase/otf/otc} 44-source-han-sans-otc.conf"
       "OTF/Japanese SourceHanSans otf $pkgbase 44-source-han-sans.conf"
       "OTF/Korean SourceHanSansK otf $pkgbase-k 44-source-han-sans-k.conf"
       "OTF/SimplifiedChinese SourceHanSansSC otf $pkgbase-sc 44-source-han-sans-sc.conf"
       "OTF/TraditionalChinese SourceHanSansTC otf $pkgbase-tc 44-source-han-sans-tc.conf")

_pkgdesc=("Adobe Source Han Sans - Pan-CJK OpenType/CFF Collection fonts"
          "Adobe Source Han Sans - Japanese OpenType/CFF fonts"
          "Adobe Source Han Sans - Korean OpenType/CFF fonts"
          "Adobe Source Han Sans - Simplified Chinese OpenType/CFF fonts"
          "Adobe Source Han Sans - Traditional Chinese OpenType/CFF fonts")

_replace=("" "$pkgbase-jp=1.000" "$pkgbase-kr=1.000" "$pkgbase-cn=1.000" "$pkgbase-twhk=1.000")

for((idx=0;idx<${#_font[@]};idx++)); do
    _info=${_font[$idx]}
    _args=($_info)
    source+=("${_args[4]}")
    for w in "${_weights[@]}"; do
        source+=("https://github.com/adobe-fonts/source-han-sans/raw/$_commit/${_args[0]}/${_args[1]}-${w}.${_args[2]}")
    done
    eval "function package_${_args[3]}() { _package $idx; }"
done

function _package {
    cd "$srcdir"
    idx=$1

    _info=${_font[$idx]}
    _args=($_info)
    _fontconfig_filename=${_args[4]}
    pkgdesc=${_pkgdesc[$idx]}
    if [[ "${_replace[$idx]}" != "" ]]; then
         replaces=("${_replace[$idx]}")
         conflicts=("${_replace[$idx]}")
    fi

    # Prepare destination directory
    install -dm755 "$pkgdir/usr/share/fonts/$pkgbase"

    for w in "${_weights[@]}"; do
	font="${_args[1]}-${w}.${_args[2]}"
        install -m644 "$font" "$pkgdir/usr/share/fonts/$pkgbase"
    done

    # Install fontconfig fix
    install -d "$pkgdir/etc/fonts/conf.d"
    install -Dm644 "$srcdir/$_fontconfig_filename" "$pkgdir/etc/fonts/conf.avail/$_fontconfig_filename"
    ln -s ../conf.avail/$_fontconfig_filename "$pkgdir/etc/fonts/conf.d/$_fontconfig_filename"
}

sha256sums=('71397a72a3b0738db191db2b924eed7804e8fe83af17582505e104e9eedc0da7'
            '91ecdc223cdf5aa3b4b11bd1b0e3fc8b3798dec9791bfa571e1b1fb0a378b476'
            'c7959d147d68ef3bd68c29c8591c254752ad00c75df7cf83c6d307286cc59131'
            '0842b9519afd9bea22dcc598db8083423d8c7b36c43fa27e85b42f11a2fdd2b1'
            'ea583b58054b90f06257b1f600b0a5510e90557a86a40faf1b8150d2fd2278bd'
            '446ac5ae946364105f737b6e66dcad5109eb26561b77e973fccd66a71e2c902a'
            '049a221a9009c0fbcbfbd4617ca5d9674b0b150b6ba277b76366b0e054563832'
            '215906590e8c2487fd35c9b4dea7a30c29662bbd76a48bbc1d7f354726eb2418'
            '18225126927cc7814fe92a3e72332685f78598afbe4ea69a2be84af825dbd1e6'
            '57c206bf5043d47561b423a30c30b39aff79cc5b156c509b80e01456086c3ac6'
            '90afc579c72104b4c88e93e8cd8bdda1a858f8ae99c238116aa39470e0809b3b'
            '418ebe4332390bba0098302a8107fd2ed375dac4d70f86c2d4be532f9a5b7122'
            '93917220ad788a8e7b25b961d16ae83f98ef42e0a2526aebd4aac608a122581e'
            'aa478b4b676c6fbc60d47c9836f5e7f6c0d39f5d7895ac34c00c7cd587195fdd'
            'b3d6a4604e91862e673c5ba55de1512c050d2e58501fd013915c634dbc69d602'
            'bc1a6fd94687430b2acb1a362967a812d06124b4108f79041b02fb1128b95e0a'
            'd975db0d9df4c71267cbb78bdb0c2ae526666162fd256c326041562a83d2b758'
            '360564d895d0068ffdb1fbd112230cdaa42c760b7a5833b4b48b02a3feca2082'
            '03e55813f2e1f12e4cfd013baf17a511c8b9de16752c4a006851314613d44729'
            '4871b57cde9cc99afd5646fd3cc3edb6f332169c6a877588936d524488c0ace0'
            '29a865c1cdf2b3310a36ff69a23c8d938f7093d4f728f5f25b6ea96e3a657a8e'
            'c82f8ddcdac43e3f9287bca1b9004450e0dc1f339266357de6b2f1f078bc4cf6'
            '2e01fb7ccd40a9b6f5097e7fe827a0f2f24d25c627231058579005d6dc0a9940'
            '494c94af2e8be24b548f899eff0522e004b91837d705491f86df125a98ac9da0'
            '140db21c2ff0966c1ba52f2945d8b368516f898abddad28a817849337aa7f917'
            'c88a820a139a1d9b9ae464cde880d9788cb2194d9f806410e671b479d12aecb1'
            '8aba9c733387b5374dc30d78fa3086638a099ea12d5ac7d39b865be8561736c8'
            '15f25023c712985eba10447d2957e29f7e9b511711a63929d163706c653dcfc6'
            'b50bb20cf85269ba5c52b03ccda90aa61a8b89be3449a1d16f486b13796f6e2a'
            '6f1223baa28b00f231143e1c3dbf9adf742304d2cd4b9680bd1d58d231f5ad0b'
            '2373d6294250d09053ec57a61e49cb246ca4eafa93f68e425cc614c557271505'
            '6820aafcc5101cb1e6bbac0a69972863d87cd2a9e8a867aac4d090fc09bebab5'
            '12c80ff78aaa29574183038527a191ff4f4948a237e923c0a95dec4c22b200d0'
            'bc403c32259d939634b90c6d41f1e1823158fa01efc6229e43af7980646946eb'
            'c9c58ec4d8d68d9c8491c8fd10e35b81f8954283be41820e8f206a23e1dd1b1c'
            'b4ff4df2d4f7a9551ebae9e4e066f1e82d6193282965221487ed5c5e93e1903b'
            '099cfd60d446e4b173c04934bfec73e759a68f20570af91515ed530c9821f871'
            'b55f7b3252efa5058b1392ebda759b4fb44ae57ad16210dfbc53d502f1779695'
            'e2e58fe36cbacd696cd66da5cb5e9ddb4048a0886c95d6d2659872d1df3814c7'
            '95aafb7f3f506427bc3cbadd37c3ab2e20d701587e031b37da3a5ce04c89ff12')
