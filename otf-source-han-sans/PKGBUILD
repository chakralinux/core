pkgbase=otf-source-han-sans
pkgname=($pkgbase $pkgbase-k $pkgbase-sc $pkgbase-tc ${pkgbase/otf/otc})
pkgver=1.001
pkgrel=1
pkgdesc='Adobe Source Han Sans - A set of Pan-CJK fonts designed to complement Source Sans Pro'
arch=('any')
license=('Apache')
url='http://sourceforge.net/adobe/source-han-sans'
depends=('fontconfig')
install="${pkgbase}.install"
source=()

_commit=cd3de5c749a4b739489317c4438cf0445adf3370
_weights=("Bold" "ExtraLight" "Heavy" "Light" "Medium" "Normal" "Regular")
_font=("OTC SourceHanSans ttc ${pkgbase/otf/otc} 44-source-han-sans-otc.conf"
       "OTF/Japanese SourceHanSans otf $pkgbase 44-source-han-sans.conf"
       "OTF/Korean SourceHanSansK otf $pkgbase-k 44-source-han-sans-k.conf"
       "OTF/SimplifiedChinese SourceHanSansSC otf $pkgbase-sc 44-source-han-sans-sc.conf"
       "OTF/TraditionalChinese SourceHanSansTC otf $pkgbase-tc 44-source-han-sans-tc.conf")

_pkgdesc=("Adobe Source Han Sans - Pan-CJK OpenType/CFF Collection fonts"
          "Adobe Source Han Sans - Japanese OpenType/CFF fonts"
          "Adobe Source Han Sans - Korean OpenType/CFF fonts"
          "Adobe Source Han Sans - Simplified Chinese OpenType/CFF fonts"
          "Adobe Source Han Sans - Traditional Chinese OpenType/CFF fonts")

_replace=("" "$pkgbase-jp=1.000" "$pkgbase-kr=1.000" "$pkgbase-cn=1.000" "$pkgbase-twhk=1.000")

for((idx=0;idx<${#_font[@]};idx++)); do
    _info=${_font[$idx]}
    _args=($_info)
    source+=("${_args[4]}")
    for w in "${_weights[@]}"; do
        source+=("https://github.com/adobe-fonts/source-han-sans/raw/$_commit/${_args[0]}/${_args[1]}-${w}.${_args[2]}")
    done
    eval "function package_${_args[3]}() { _package $idx; }"
done

function _package {
    cd "$srcdir"
    idx=$1

    _info=${_font[$idx]}
    _args=($_info)
    _fontconfig_filename=${_args[4]}
    pkgdesc=${_pkgdesc[$idx]}
    if [[ "${_replace[$idx]}" != "" ]]; then
         replaces=("${_replace[$idx]}")
         conflicts=("${_replace[$idx]}")
    fi

    # Prepare destination directory
    install -dm755 "$pkgdir/usr/share/fonts/$pkgbase"

    for w in "${_weights[@]}"; do
	font="${_args[1]}-${w}.${_args[2]}"
        install -m644 "$font" "$pkgdir/usr/share/fonts/$pkgbase"
    done

    # Install fontconfig fix
    install -d "$pkgdir/etc/fonts/conf.d"
    install -Dm644 "$srcdir/$_fontconfig_filename" "$pkgdir/etc/fonts/conf.avail/$_fontconfig_filename"
    ln -s ../conf.avail/$_fontconfig_filename "$pkgdir/etc/fonts/conf.d/$_fontconfig_filename"
}

sha256sums=('71397a72a3b0738db191db2b924eed7804e8fe83af17582505e104e9eedc0da7'
            '519c26a7a113c998cc9d16382f9b5b13b80bb3fc29f7638969313894d12522c0'
            'a6a5ebd00898e7c10b689445f429c5edc2aa031e8103aeed64b6aca76a624b3f'
            '90f9fba2ad31c4a0fc12c75a37b9fefb139f5f23ec468abbe169d5a408b15a0d'
            '1c6febc377266b172ad111029a01bbad9de14a8f8656c07bdb83641a6df19050'
            '92476384d9bc3d94f9fecb1acdc1087e3b93c9a746e7b5bf029038fd0dd7ab9b'
            'bef45b1526fd9d2a4514da1de41ce4b4666972bc1a86a469f8ab3136d59da926'
            '650200959ff1136a69f195bd5c939c15daa38b421d46aa3c4e3e1f353ae30b06'
            '18225126927cc7814fe92a3e72332685f78598afbe4ea69a2be84af825dbd1e6'
            'a420bd4945bdce5a053d9920571bb7b4367227f764f01f6536209259d8d5a793'
            '7609fa02ad28f3c658edcdfb45a38ef058c7be885c84a623560c4f4729d6f5da'
            '8c921d491ea57d49f554bd6054f8fe03771f38d4e83693c708391804863f2238'
            '1a466db820ff953fb97b82b5dd4572e387e2be2814f3076e99e055272d08544f'
            '0a57ec3875746d65fdad0ef557e0dec908dbe42bc564df284d06c1601e837fdf'
            '4ca2d7600d16f2ab2dd8efe074090c1d2252e452fd51518716096237b6ca7b52'
            '5f4b9181b1f7667dac6c1414e06dff4df51f339184e7cd98be6b473fa284f602'
            'd975db0d9df4c71267cbb78bdb0c2ae526666162fd256c326041562a83d2b758'
            '9392392a01c94b9c9b90aced8982d75ea8a1f18f4f61f2d2c307afa8af5daba5'
            '857b4bf7473e30763a0bd69fe060d2693e414f4b6a18b5730dc6c2808d8b586f'
            'a85c3ad34ff29570d72a968690f3d4233a71410803c49cff8272efac6fd1be2d'
            '82923bfb9e61397ddabdb06dff311a0077a4d8b11684baad6ba70e73826bdaf4'
            '05713cc509440b39dd44df6b0e4a828f7f741cf00fb066e2d2aae63594951345'
            '6125be405c7f733b4a681b01084210102395a1ceb70b026c3a8f3e07fc164319'
            '1da33a8003ed5c1a1700ed6858aa98fccdbd33e5049331cd56535f3a244d297d'
            '140db21c2ff0966c1ba52f2945d8b368516f898abddad28a817849337aa7f917'
            '13cee61f53ea88c5e299e4d3d18105441f11550a9aa7136f3b543ebfb64fc5e1'
            'd846aa8d20f712b0e454a33c20a458ca3209bd45f663c340e939fee6023d85df'
            '5cf7346137fd971f376b12d8e5a0540a4d8304bf489adf6acf1cd2b30da69988'
            '2155b7af41067f06d52fe41e0ceafbce0a548aae5f265d13c63e47b1a8fbb15f'
            '90b9faefcbaacdc6ef4fa3a11d783d3acb4fe0eda486f4440633933e6267d460'
            '3b0b1a24ddfed6870f11cf56b139fe906bb1c9239d8bb4a312e3bcdda696153a'
            'c8318b4a5f3865d21d1dcb807977782998fffd4d75bc19086f1930f225e2a8f5'
            '12c80ff78aaa29574183038527a191ff4f4948a237e923c0a95dec4c22b200d0'
            '917121b84d40cf2fd8bba70403209cbe02922d4d181c3ef7532787818a72730b'
            'c75a0e2cf6586e28f2318e28703819a5c9ad906426d10c49e816711f91a9423d'
            'f7f175ce178c042c1f5b1995e66f474f34d566b1f7dc1ea5ec2a4ff56edccf53'
            'd2a98f0d905491dd8cefceb97fba6c6bfad368bf5cbfc61477a42068942b8160'
            '00ebc935bf8f55d8b35a51b5aaa86bfefe000aaf6b490c84844e9dea976d955e'
            'dd4b14726dfcbf1111e36827cd4f2075a395d1173fceaccde84f3c3633598960'
            '96b7951c094838454b5d13f5c3493a834e0b28b814906a7f99e3843c0f83a85b')
