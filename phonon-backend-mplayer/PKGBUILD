#
# Phonon Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=('phonon-backend-mplayer')
_pkgname=('phonon-mplayer')
pkgver=20120212
pkgrel=2
pkgdesc='Phonon MPlayer backend'
arch=('i686' 'x86_64')
url='http://phonon.kde.org'
license=('LGPL')
depends=('phonon' 'mplayer')
makedepends=('qt' 'pkgconfig' 'cmake' 'automoc4' 'git' 'mesa')
groups=("kde-complete" "kde-uninstall")
conflicts=("phonon-mplayer-svn" 'phonon-mplayer')
replaces=("phonon-mplayer-svn" 'phonon-mplayer')
source=(http://chakra-linux.org/sources/${pkgname}/${pkgname}-${pkgver}.tar.xz)
md5sums=(3e4334033ff7930a9b2a55a8b46fc9db)

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf ${pkgname}-${pkgver}
	  git clone git://anongit.kde.org/${_pkgname}.git ${pkgname}-${pkgver}
	  rm -vRf ${pkgname}-${pkgver}/.git
	  pushd ${pkgname}-${pkgver}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}.tar.xz ${pkgname}-${pkgver}/*
	  md5sum ${pkgname}-${pkgver}.tar.xz
}

build() {
	cd "$srcdir/${pkgname}-${pkgver}"

	msg "Starting make..."

	# Config
	[ ${CARCH} = 'x86_64' ] && CXXFLAGS="$CXXFLAGS -fPIC"

	# Build
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release \
		-DPLUGIN_INSTALL_DIR=/usr/lib/kde4 -DSERVICES_INSTALL_DIR=/usr/share/kde4/services . || return 1
	make || return 1
	make DESTDIR=${pkgdir} install || return 1
	rm -rf "${srcdir}/${_gitname}-build"
}

