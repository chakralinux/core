# Platform Packages for Chakra, part of chakra-project.org
#
# Maintainer: Neophytos Kolokotronis <tetris4@gmail.com>
# Contributor: Samsagax <samsagax@gmail.com>
# Contributor: borman <borisov.mikhail@gmail.com>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=nvidia-utils-bumblebee

_pacman_get_key()
{
  pacman --print --print-format $1 -S nvidia-utils | grep nvidia-utils
}

pkgver=295.20
pkgrel=1
pkgdesc="NVIDIA drivers utilities and libraries. Repacked and installed in different folder to be used simultaneously with libgl."
arch=('i686' 'x86_64')
url="http://www.nvidia.com/"
depends=('xorg-server' 'libxvmc' "dkms-nvidia=$pkgver" "opencl-nvidia=$pkgver")
optdepends=('gtk2: nvidia-settings' 'pkgconfig: nvidia-xconfig')
conflicts=('nvidia-utils')
provides=("nvidia-utils=$pkgver")
license=('custom')
install=nvidia.install
if [ "$CARCH" = "i686" ]; then
     md5sums=('7055d8c7635930fe0c7d774d7bab0dca')
elif [ "$CARCH" = "x86_64" ]; then
     md5sums=('11a0f421e7c7c1144410985d70b8c952')
     optdepends[${#optdepends[@]}]='lib32-nvidia-utils-bumblebee'
fi
source=$(_pacman_get_key %l)

build()
{
  cd $srcdir
  msg "Copying files..."
  cp -a usr $pkgdir || return 1
  mkdir -p $pkgdir/usr/libtemp/nvidia-bumblebee
  mv $pkgdir/usr/lib/* $pkgdir/usr/libtemp/nvidia-bumblebee/
  mv -T $pkgdir/usr/libtemp/ $pkgdir/usr/lib/
  # Dirty hack to use nvidia-smi
  cd $pkgdir/usr/lib/
  ln -s nvidia-bumblebee/libnvidia-ml.so.1
}
