#
# Platform Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

# Find the kernel name inside the chroot
_kernver=`pacman -Q linux | cut -c7-9 | sed 's/linux //g'`-CHAKRA

pkgname=rtl8192
pkgver=0004.0816.2011
pkgrel=1
pkgdesc="Driver for Realtek 8192CE/DE/SE PCI wireless chipsets."
license=("GPL")
depends=('linux-headers')
replaces=(rtl8192se)
source=("http://chakra.sourceforge.net/sources/$pkgname/92ce_se_de_linux_mac80211_${pkgver}.tar.gz")
arch=('i686' 'x86_64')
url="http://www.realtek.com.tw/"
install="${pkgname}.install"

build() {
	cd ${srcdir}/rtl_92ce_92se_92de_linux_mac80211_${pkgver}

    patch < ../../wifi.h.patch

	make || return 1

	mkdir -p ${pkgdir}/lib/firmware
	cp -rf firmware/rtlwifi ${pkgdir}/lib/firmware/rtlwifi
	
	mkdir -p ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi/rtl8192{c,d,s}e
	cp -f rtl8192ce/rtl8192ce.ko ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi/rtl8192ce
	cp -f rtl8192de/rtl8192de.ko ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi/rtl8192de
	cp -f rtl8192se/rtl8192se.ko ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi/rtl8192se
	cp -f rtlwifi.ko ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi
    find ${pkgdir}/lib/modules/$_kernver/kernel/drivers/net/wireless/rtlwifi -name '*.ko' -exec gzip {} \;
}

md5sums=('42b1583c3aa3383995299e58bb787e9c')