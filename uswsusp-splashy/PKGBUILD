#
# Platform Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

pkgname="uswsusp-splashy"
pkgver=20110221
pkgrel=1
pkgdesc="Allows suspending with new userspace suspend and Splashy."
arch=('i686' 'x86_64')
url="http://suspend.sourceforge.net"
license=('GPL')
depends=('lzo2' 'libx86' 'libgcrypt' 'splashy')
makedepends=('libgcrypt' 'gcc' 'make' 'git')
conflicts=('suspend' 'uswsusp')
provides=('uswsusp')
options=('docs' 'zipman')
backup=('etc/suspend.conf')
install=uswsusp.install
source=(http://chakra-project.org/sources/${pkgname}/${pkgname}-${pkgver}-${pkgrel}.tar.xz
	uresume-hook
	uresume-install
	s2ram-chvt63.patch)
md5sums=('99d15a0e80e44f2a0b755d888ca36d19'
         'a2dfd5ad0d1875a572fdfc134dcd049f'
         'e6939703649eba3536f836f99f49b7fd'
         '320f94e40e1a931f4a17cba0aec69e30')

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf tribe
	  git clone git://git.kernel.org/pub/scm/linux/kernel/git/rafael/suspend-utils.git ${pkgname}
	  rm -vRf ${pkgname}/.git
	  pushd ${pkgname}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}-${pkgrel}.tar.xz ${pkgname}/*
	  md5sum ${pkgname}-${pkgver}-${pkgrel}.tar.xz
}

build() {
	cd ${srcdir}/${pkgname}

	# Switch to a black screen instead of console on s2ram
	patch -Np1 -i ../s2ram-chvt63.patch || return 1

	./autogen.sh
	./configure --enable-compress --enable-encrypt \
		--disable-resume-static --disable-static \
		--enable-splashy \
		--prefix=/usr --sysconfdir=/etc
	make DESTDIR=${pkgdir} install || return 1

	install -D -m 644 ../uresume-hook ${startdir}/pkg/lib/initcpio/hooks/uresume && \
	install -D -m 644 ../uresume-install ${startdir}/pkg/lib/initcpio/install/uresume
}
