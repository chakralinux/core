# Maintainer: Neophytos Kolokotronis <tetris4 AT gmail DOT com>
# Contributions from Arch: https://projects.archlinux.org/svntogit/packages.git/tree/trunk?h=packages/phonon

pkgbase=phonon
pkgname=("phonon" "phonon-qt5")
pkgver=4.8.0
pkgrel=2
arch=('x86_64')
url="http://phonon.kde.org"
license=('LGPL')
makedepends=('cmake' 'automoc4' 'qt5-base' 'qt5-tools' 'qt5-quick1' 'qt5-base' 'qt5-tools' 'qt5-quick1')
options=("debug" "!emptydirs")
source=("http://download.kde.org/stable/${pkgname}/${pkgver}/${pkgname}-${pkgver}.tar.xz"
	     'pulsesupport.patch')
sha256sums=('819e9734d20e254b4599d8ab45f15a68d95444c4e2088c7eb5769b58976a11be'         
            'bc3b4cc3ac171462adc3730e5f80a65bcfc082f04282ad605765f0db5954d4c7')

prepare(){
  mkdir "${srcdir}"/build
  mkdir "${srcdir}"/build-qt5
  # patch form Comment#38 at https://bugs.kde.org/show_bug.cgi?id=324975#c38
  patch -uN ${srcdir}/${pkgname}-${pkgver}/phonon/pulsesupport.cpp ${srcdir}/pulsesupport.patch
}

build() {
  cd "${srcdir}"/build
  cmake ../${pkgname}-${pkgver} \
    -DCMAKE_BUILD_TYPE=RelWithDebInfo \
    -DCMAKE_SKIP_RPATH=ON \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DPHONON_INSTALL_QT_EXTENSIONS_INTO_SYSTEM_QT=ON \
    -DCMAKE_INSTALL_LIBDIR=lib
  make
  cd "${srcdir}"/build-qt5
  cmake ../${pkgname}-${pkgver} \
    -DCMAKE_BUILD_TYPE=RelWithDebInfo \
    -DCMAKE_SKIP_RPATH=ON \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DPHONON_INSTALL_QT_EXTENSIONS_INTO_SYSTEM_QT=ON \
    -DPHONON_BUILD_PHONON4QT5=ON \
    -DCMAKE_INSTALL_LIBDIR=lib
  make
}

package_phonon(){
  pkgdesc="The multimedia framework for KDE4"
  depends=('pulseaudio' 'libqzeitgeist' 'qtwebkit' 'phonon-backend')
  cd "${srcdir}"/build
  make DESTDIR="${pkgdir}" install
}

package_phonon-qt5(){
  depends=('libpulse' 'qt5-base' 'phonon-qt5-backend')
  pkgdesc="The multimedia framework for KF5"
  cd "${srcdir}"/build-qt5
  make DESTDIR="${pkgdir}" install
}
sha256sums=('3bcb2a66c83fc5a4518a49cc96bb8971f155947571050a0e02b6be13c91ed524'
            'bc3b4cc3ac171462adc3730e5f80a65bcfc082f04282ad605765f0db5954d4c7')
