
pkgname=vhba-module
pkgver=20170610
pkgrel=15
pkgdesc="Kernel module that emulates SCSI devices"
arch=('x86_64')
url="http://cdemu.sourceforge.net/"
license=('GPL')
depends=("linux=4.18.6")
makedepends=("linux-headers=4.18.6")
_extramodules=extramodules-CHAKRA
source=("http://downloads.sourceforge.net/cdemu/$pkgname-$pkgver.tar.bz2"
        60-vhba.rules)
md5sums=('f9478a5f5528fc672c204b6b4bd02213'
         '4dc37dc348b5a2c83585829bde790dcc')

prepare() {
  cd $pkgname-$pkgver
}

build() {
  cd $pkgname-$pkgver
  make KERNELRELEASE="$(cat /usr/lib/modules/$_extramodules/version)"
}

package() {
  cd $pkgname-$pkgver
  install -Dt "$pkgdir/usr/lib/modules/$_extramodules" -m644 vhba.ko
  install -Dt "$pkgdir/usr/lib/udev/rules.d" -m644 ../60-vhba.rules
}
