# Source env-settings
source ../_buildscripts/`pwd | cut -d/ -f3`-${_arch}-makepkg.conf
# Pre-Patch settings
_patch="3.0.5pre"
_queue="3.0"
# Aufs
_aufs="3.0-20110919"
# Kernel source file
#SRC="ftp://ftp.kernel.org/pub/linux/kernel/v3.0/linux-3.0.tar.bz2"
SRC="http://ftp.uni-erlangen.de/pub/mirrors/kernel.org/v3.0/linux-3.0.tar.bz2"
# Original source directory
SRCORIG="linux-3.0"
# Our source directory
SRCNAME="linux-3.0-CHAKRA"
# Patches:
#   URL%patchlevel
#  or
#   filename%patchlevel (file must be in patches subdirectory)
PATCHES=(
         # add upstream patch from 3.0 series
         #ftp://ftp.kernel.org/pub/linux/kernel/v3.0/patch-3.0.4.gz%1
         http://ftp.uni-erlangen.de/pub/mirrors/kernel.org/v3.0/patch-3.0.4.gz%1

         # add latest fixes from stable queue, if needed
         # http://git.kernel.org/?p=linux/kernel/git/stable/stable-queue.git
         http://chakra-project.org/sources/linux/patches/3/upstream/$_patch.patch%1

         # fix #19234 i1915 display size
         http://chakra-project.org/sources/linux/patches/3/bugfix/fix-i915.patch%1

         # fix several webcams (https://bugzilla.kernel.org/show_bug.cgi?id=35922)
         http://chakra-project.org/sources/linux/patches/3/bugfix/webcam-usb_quirk_reset_resume.patch%1

         # set DEFAULT_CONSOLE_LOGLEVEL to 4 (same value as the 'quiet' kernel param)
         # remove this when a Kconfig knob is made available by upstream
         # (relevant patch sent upstream: https://lkml.org/lkml/2011/7/26/227)
         http://chakra-project.org/sources/linux/patches/3/bugfix/change-default-console-loglevel.patch%1

         # stable candidate patches
         http://chakra-project.org/sources/linux/patches/3/candidate/0001-md-linear-avoid-corrupting-structure-while-waiting-f.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0002-drm-radeon-kms-set-a-default-max_pixel_clock.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0003-drm-radeon-kms-make-sure-pci-max-read-request-size-i.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0004-mm-page-allocator-reconsider-zones-for-allocation-af.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0005-mm-page-allocator-initialise-ZLC-for-first-zone-elig.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0006-igb-fix-WOL-on-second-port-of-i350-device.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0007-MXC-iomux-v3-correct-NO_PAD_CTRL-definition.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0008-x86-perf-Check-that-current-mm-is-alive-before-getti.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0009-sched-Separate-the-scheduler-entry-for-preemption.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0010-sched-Move-blk_schedule_flush_plug-out-of-__schedule.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0011-sched-Fix-a-memory-leak-in-__sdt_free.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0012-rtc-Fix-RTC-PIE-frequency-limit.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0013-mmc-sdhci-s3c-Fix-mmc-card-I-O-problem.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0014-mmc-rename-mmc_host_clk_-ungate-gate-to-mmc_host_clk.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0015-mmc-core-use-non-reentrant-workqueue-for-clock-gatin.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0016-mmc-core-prevent-aggressive-clock-gating-racing-with.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0017-alarmtimers-Memset-itimerspec-passed-into-alarm_time.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0018-alarmtimers-Avoid-possible-null-pointer-traversal.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0019-alarmtimers-Avoid-possible-denial-of-service-with-hi.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0020-xen-smp-Warn-user-why-they-keel-over-nosmp-or-noapic.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0021-md-Fix-handling-for-devices-from-2TB-to-4TB-in-0.90-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0022-vp7045-fix-buffer-setup.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0023-nuvoton-cir-simplify-raw-IR-sample-handling.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0024-hwmon-max16065-Fix-current-calculation.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0025-drm-nouveau-properly-handle-allocation-failure-in-no.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0026-Avoid-dereferencing-a-request_queue-after-last-close.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0027-ARM-davinci-fix-cache-flush-build-error.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0028-ARM-davinci-da850-EVM-read-mac-address-from-SPI-flas.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0029-ARM-7081-1-mach-integrator-fix-the-clocksource.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0030-net-9p-Fix-the-msize-calculation.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0031-VirtIO-can-transfer-VIRTQUEUE_NUM-of-pages.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0032-net-9p-fix-client-code-to-fail-more-gracefully-on-pr.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0033-irda-fix-smsc-ircc2-section-mismatch-warning.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0034-iommu-amd-Make-sure-iommu-need_sync-contains-correct.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0035-iommu-amd-Don-t-take-domain-lock-recursivly.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0036-fs-9p-When-doing-inode-lookup-compare-qid-details-an.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0037-fs-9p-Fix-invalid-mount-options-args.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0038-fs-9p-Fid-is-not-valid-after-a-failed-clunk.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0039-fs-9p-Always-ask-new-inode-in-create.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0040-Fix-the-size-of-receive-buffer-packing-onto-VirtIO-r.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0041-9p-close-ACL-leaks.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0042-ACPICA-Do-not-repair-_TSS-return-package-if-_PSS-is-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0043-net-9p-Fix-kernel-crash-with-msize-512K.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0044-fs-9p-Use-protocol-defined-value-for-lock-getlock-ty.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0045-fs-9p-Don-t-update-file-type-when-updating-file-attr.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0046-fs-9p-Always-ask-new-inode-in-lookup-for-cache-mode-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0047-fs-9p-Add-fid-before-dentry-instantiation.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0048-PCI-Set-PCI-E-Max-Payload-Size-on-fabric.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0049-PCI-Remove-MRRS-modification-from-MPS-setting-code.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0050-PCI-export-pcie_bus_configure_settings-symbol.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0051-fs-9p-Add-OS-dependent-open-flags-in-9p-protocol.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0052-isci-fix-sata-response-handling.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0053-x86-iommu-Mark-DMAR-IRQ-as-non-threaded.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0054-rtlwifi-rtl8192su-Fix-problem-connecting-to-HT-enabl.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0055-rtlwifi-Fix-problem-when-switching-connections.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0056-mfd-Make-omap-usb-host-TLL-mode-work-again.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0057-mfd-Fix-value-of-WM8994_CONFIGURE_GPIO.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0058-mfd-Fix-initialisation-of-tps65910-interrupts.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0059-mac80211-fix-missing-sta_lock-in-__sta_info_destroy.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0060-iwlegacy-fix-BUG_ON-info-control.rates-0-.idx-0.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0061-isci-fix-32-bit-operation-when-CONFIG_HIGHMEM64G-n.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0062-hpsa-fix-problem-that-OBDR-devices-are-not-detected.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0063-hpsa-fix-physical-device-lun-and-target-numbering-pr.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0064-genirq-Make-irq_shutdown-symmetric-vs.-irq_startup-a.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0065-e1000-Fix-driver-to-be-used-on-PA-RISC-C8000-worksta.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0066-ath9k_hw-fix-calibration-on-5-ghz.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0067-ASoC-MPC5200-replace-of_device-with-platform_device.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0068-ASoC-Fix-reporting-of-partial-jack-updates.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0069-ASoC-Blackfin-bf5xx-ad193x-Fix-codec-device-name.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0070-acpica-ACPI_MAX_SLEEP-should-be-2-sec-not-20.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0071-vfs-automount-should-ignore-LOOKUP_FOLLOW.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0072-workqueue-lock-cwq-access-in-drain_workqueue.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0073-USB-xhci-Set-change-bit-when-warm-reset-change-is-se.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0074-restore-pinning-the-victim-dentry-in-vfs_rmdir-vfs_r.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0075-mm-sync-vmalloc-address-space-page-tables-in-alloc_v.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0076-ibmveth-Fix-issue-with-DMA-mapping-failure.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0077-ibmveth-Fix-DMA-unmap-error.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0078-ibmveth-Checksum-offload-is-always-disabled.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0079-firewire-ohci-add-no-MSI-quirk-for-O2Micro-controlle.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0080-drm-radeon-kms-Make-GPU-CPU-page-size-handling-consi.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0081-drm-radeon-Don-t-read-from-CP-ring-write-pointer-reg.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0082-drm-radeon-kms-fix-typo-in-r100_blit_copy.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0083-drivers-leds-ledtrig-timer.c-fix-broken-sysfs-delay-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0084-drivers-cpufreq-pcc-cpufreq.c-avoid-NULL-pointer-der.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0085-ALSA-pcm-fix-race-condition-in-wait_for_avail.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0086-ALSA-HDA-Cirrus-fix-Surround-Speaker-volume-control-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0087-iwlagn-fix-command-queue-timeout.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0088-cifs-fix-possible-memory-corruption-in-CIFSFindNext.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0089-Fix-the-conflict-between-rwpidforward-and-rw-mount-o.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0090-ALSA-hda-realtek-Fix-auto-mute-with-HP-LO-configurat.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0091-ARM-Dove-fix-second-SPI-initialization-call.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0092-XZ-Fix-incorrect-XZ_BUF_ERROR.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0093-xen-use-maximum-reservation-to-limit-amount-of-usabl.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0094-xen-e820-if-there-is-no-dom0_mem-don-t-tweak-extra_p.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0095-wireless-Reset-beacon_found-while-updating-regulator.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0096-rtl2800usb-Fix-incorrect-storage-of-MAC-address-on-b.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0097-rt2800pci-Fix-compiler-error-on-PowerPC.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0098-make-proc-pid-numa_maps-gather_stats-take-variable-p.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0099-ixgbe-fix-possible-null-buffer-error.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0100-iwlagn-workaround-bug-crashing-some-APs.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0101-floppy-use-del_timer_sync-in-init-cleanup.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0102-break-out-numa_maps-gather_pte_stats-checks.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0103-blk-cgroup-be-able-to-remove-the-record-of-unplugged.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0104-b43-Fix-beacon-problem-in-ad-hoc-mode.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0105-writeback-update-dirtied_when-for-synced-inode-to-pr.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0106-writeback-introduce-.tagged_writepages-for-the-WB_SY.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0107-tg3-Fix-io-failures-after-chip-reset.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0108-tg3-Fix-int-selftest-for-recent-devices.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0109-tg3-Add-5719-and-5720-to-EEE_CAP-list.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0110-USB-PL2303-correctly-handle-baudrates-above-115200.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0111-perf-x86-Add-model-45-SandyBridge-support.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0112-mpt2sas-Adding-support-for-customer-specific-brandin.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0113-qdio-clear-shared-DSCI-before-scheduling-the-queue-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0114-ipc-mqueue.c-refactor-failure-handling.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0115-libfc-Enhancement-to-RPORT-state-machine-applicable-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0116-iscsi_tcp-fix-locking-around-iscsi-sk-user-data.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0117-ipc-mqueue.c-fix-mq_open-return-value.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0118-ehci-refactor-pci-quirk-to-use-standard-dmi_check_sy.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0119-ehci-add-pci-quirk-for-Ordissimo-and-RM-Slate-100-to.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0120-fcoe-Unable-to-select-the-exchangeID-from-offload-po.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0121-cdc_ncm-fix-endianness-problem.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0122-ASIX-Add-AX88772B-USB-ID.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0123-teach-proc-pid-numa_maps-about-transparent-hugepages.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0124-xfrm-Perform-a-replay-check-after-return-from-async-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0125-vlan-reset-headers-on-accel-emulation-path.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0126-tcp-initialize-variable-ecn_ok-in-syncookies-path.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0127-tcp-fix-validation-of-D-SACK.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0128-scm-Capture-the-full-credentials-of-the-scm-sender.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0129-net_sched-prio-use-qdisc_dequeue_peeked.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0130-Revert-sfc-Use-write-combining-to-reduce-TX-latency-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0131-netfilter-TCP-and-raw-fix-for-ip_route_me_harder.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0132-mcast-Fix-source-address-selection-for-multicast-lis.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0133-ipv6-Fix-ipv6_getsockopt-for-IPV6_2292PKTOPTIONS.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0134-ipv4-some-rt_iif-rt_route_iif-conversions.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0135-fib-fix-BUG_ON-in-fib_nl_newrule-when-add-new-fib-ru.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0136-bridge-fix-a-possible-use-after-free.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0137-bridge-fix-a-possible-net_device-leak.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0138-bridge-Pseudo-header-required-for-the-checksum-of-IC.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0139-arp-fix-rcu-lockdep-splat-in-arp_process.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0140-zorro-Defer-device_register-until-all-devices-have-b.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0141-TPM-Zero-buffer-after-copying-to-userspace.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0142-TPM-Call-tpm_transmit-with-correct-size.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0143-lpfc-8.3.25-T10-DIF-Fixes.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0144-lpfc-8.3.25-PCI-and-SR-IOV-Fixes.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0145-lpfc-8.3.25-Miscellaneous-Bug-fixes-and-code-cleanup.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0146-lpfc-8.3.25-Fabric-and-Target-Discovery-Fixes.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0147-lpfc-8.3.25-Adapter-Interface-fixes-and-changes.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0148-libiscsi_tcp-fix-LLD-data-allocation.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0149-isci-fix-event-get-pointer-increment.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0150-isci-change-sas-phy-timeouts-from-54us-to-59us.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0151-isci-Leave-requests-alone-if-already-terminating.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0152-ahci-RAID-mode-SATA-patch-for-Intel-Panther-Point-De.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0153-Bluetooth-Fix-timeout-on-scanning-for-the-second-tim.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0154-usb-host-pci-quirks.c-correct-annotation-of-ehci_dmi.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0155-perf-symbols-Fix-ppc64-SEGV-in-dso__load_sym-with-de.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0156-drm-radeon-kms-fix-DDIA-enable-on-some-rs690-systems.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0157-ALSA-usb-audio-clear-chip-probing-on-error-exit.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0158-ALSA-fm801-Fix-double-free-in-case-of-error-in-tuner.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0159-ALSA-fm801-Gracefully-handle-failure-of-tuner-auto-d.patch%1

         # add aufs3 support, in reference to:
         # http://aufs.sourceforge.net
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-kbuild.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-base.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-standalone.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs.patch.bz2%1

         # add overlayfs v11 from git
         # http://git.kernel.org/?p=linux/kernel/git/mszeredi/vfs.git;a=shortlog;h=refs/heads/overlayfs.v11
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/01-vfs_add-i_op-_open.patch.bz2%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/02-vfs_export-do_splice_direct-to-modules.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/03-vfs_introduce-clone_private_mount.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/04-overlay-filesystem.patch.bz2%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/05-overlayfs_add-statfs-support.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/06-overlayfs_implement-show_options.patch%1
         # don't wanted feature
         #http://chakra-project.org/sources/linux/patches/3/features/overlayfs/08-fs_limit filesystem stacking depth.patch%1

         # with Jordi Pujol's overlayfs patches following:
         # for performance and improvement
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/50-copy-up-performance.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/51-improve-ovl_copy_up_xattr.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/52-vfs_getxattr-performance.patch%1
         # suppress unreliable code, it confuses /proc/mounts
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/59-read-only.patch%1
         # revert Linux 3.1 functions to 3.0
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/60-overlayfs-v10-ovl_permission.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/61-overlayfs-v10-ovl_dir_fsync.patch%1

         # add fedora patches
         http://chakra-project.org/sources/linux/patches/3/features/fedora/die-floppy-die.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-intel-make-lvds-work.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-nouveau-updates.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-ttm-nouveau-oops-fix.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/efi-dont-map-boot-services-on-32bit.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/hda_intel-prealloc-4mb-dmabuffer.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/linux-2.6-input-kill-stupid-messages.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/linux-2.6-intel-iommu-igfx.patch%1

         # add acerhk
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/01_acerhk-0.5.35.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/02_64bits_support_for_aspire5100.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/03_Add_Medion_MD97600_support.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/04_3rd-acerhk-proc_dir_entry-owner.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/05_kbuild.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/06_lindent.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/07_remove-ifdefs-for-ancient-kernels.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/08_remove-ifdefs-for-ACERDEBUG.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/09_kcompat-2.6.36.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/10_kcompat-2.6.38.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/11_bg-flag.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/12_Get-rid-off-bios-error.patch%1

         # revert rt2x00 changes to apply new drivers
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0001-Revert-rt2x00-Add-device-ID-for-RT539F-device.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0002-Revert-rt2x00-rt2800-fix-zeroing-skb-structure.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0003-Revert-rt2x00-fix-usage-of-NULL-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0004-Revert-rt2x00-fix-order-of-entry-flags-modification.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0005-Revert-rt2x00-do-not-drop-usb-dev-reference-counter-.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0006-Revert-rt2x00-fix-crash-in-rt2800usb_write_tx_desc.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0007-Revert-rt2x00-fix-crash-in-rt2800usb_get_txwi.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0008-Revert-rt2800pci-Fix-compiler-error-on-PowerPC.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0009-Revert-rtl2800usb-Fix-incorrect-storage-of-MAC-addre.patch%1

         # add rt2x00 drivers from 3.1 tree (31-rc7)
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0001-rt2x00-Enable-PA_PE-bits-in-TX_PIN_CFG-according-to-.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0002-rt2x00-Don-t-disable-G0-PA_PE-bit-in-case-of-BT-coex.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0003-rt2x00-Add-support-for-RT3572-RT3592-RT3592-Bluetoot.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0004-rt2x00-Interface-sequence-lock-doesn-t-have-to-disab.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0005-rt2x00-Move-rt2800_txdone-and-rt2800_txdone_entry_ch.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0006-rt2x00-Enabled-rt35xx-device-support-by-default.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0009-rt2x00-fix-possible-memory-corruption-in-case-of-inv.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0010-rt2x00-reset-usb-devices-at-probe.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0011-rt2x00-Fix-unspeficied-typo.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0012-rt2x00-Serialize-TX-operations-on-a-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0013-rt2x00-Don-t-use-queue-entry-as-parameter-when-creat.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0014-rt2x00-Reduce-window-of-a-queue-s-tx-lock.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0015-rt2x00-Add-device-ID-for-RT539F-device.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0016-rt2x00-Properly-identify-rt2800usb-devices.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0017-rt2x00-Implement-tx_frames_pending-mac80211-callback.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0018-rt2800usb-Add-new-device-ID-for-Belkin.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0019-rt2x00-rt2800-fix-zeroing-skb-structure.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0020-rt2x00-Fix-compilation-without-CONFIG_RT2X00_LIB_CRY.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0021-rt2x00-fix-usage-of-NULL-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0022-rt2x00-Add-new-rt73-buffalo-USB-id.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0023-rt2x00-Add-rt2870-device-id-for-Dvico-usb-key.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0024-rt2x00-fix-crash-in-rt2800usb_write_tx_desc.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0025-rt2x00-fix-order-of-entry-flags-modification.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0026-rt2x00-fix-crash-in-rt2800usb_get_txwi.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0027-rt2x00-do-not-drop-usb-dev-reference-counter-on-susp.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0028-rt2800pci-Fix-compiler-error-on-PowerPC.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0029-rtl2800usb-Fix-incorrect-storage-of-MAC-address-on-b.patch%1

        )
# Name of the resulting patch (will be bzipped afterwards)
PATCHNAME="patch-3.0.4-4-CHAKRA"

# Run this before applying patches
pre_apply() {
  :
}

# Run this after applying patches
post_apply() {
  # remove the sublevel and extraversion from Makefile
  # this ensures our kernel version is always 3.X-CHAKRA
  # this way, minor kernel updates will not break external modules
  sed -i 's|^SUBLEVEL = .*$|SUBLEVEL = |g' Makefile
  sed -i 's|^EXTRAVERSION = .*$|EXTRAVERSION = |g' Makefile

  # Kill some files
  find . -name '*~' -exec rm -f {} \; 2>/dev/null
}
