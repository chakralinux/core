# Source env-settings
source ../_buildscripts/`pwd | cut -d/ -f3`-${_arch}-makepkg.conf
# Pre-Patch settings
_patch="3.0.5pre"
_queue="3.0"
# Aufs
_aufs="3.0-20110919"
# Kernel source file
SRC="ftp://ftp.kernel.org/pub/linux/kernel/v3.0/linux-3.0.tar.bz2"
# Original source directory
SRCORIG="linux-3.0"
# Our source directory
SRCNAME="linux-3.0-CHAKRA"
# Patches:
#   URL%patchlevel
#  or
#   filename%patchlevel (file must be in patches subdirectory)
PATCHES=(
         # add upstream patch from 3.0 series
         ftp://ftp.kernel.org/pub/linux/kernel/v3.0/patch-3.0.4.gz%1

         # add latest fixes from stable queue, if needed
         # http://git.kernel.org/?p=linux/kernel/git/stable/stable-queue.git
         http://chakra-project.org/sources/linux/patches/3/upstream/$_patch.patch%1

         # fix #19234 i1915 display size
         http://chakra-project.org/sources/linux/patches/3/bugfix/fix-i915.patch%1

         # fix several webcams (https://bugzilla.kernel.org/show_bug.cgi?id=35922)
         http://chakra-project.org/sources/linux/patches/3/bugfix/webcam-usb_quirk_reset_resume.patch%1

         # set DEFAULT_CONSOLE_LOGLEVEL to 4 (same value as the 'quiet' kernel param)
         # remove this when a Kconfig knob is made available by upstream
         # (relevant patch sent upstream: https://lkml.org/lkml/2011/7/26/227)
         http://chakra-project.org/sources/linux/patches/3/bugfix/change-default-console-loglevel.patch%1

         # add aufs3 support, in reference to:
         # http://aufs.sourceforge.net
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-kbuild.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-base.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs-standalone.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/aufs3/aufs$_aufs.patch.bz2%1

         # add overlayfs v11 from git
         # http://git.kernel.org/?p=linux/kernel/git/mszeredi/vfs.git;a=shortlog;h=refs/heads/overlayfs.v11
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/01-vfs_add-i_op-_open.patch.bz2%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/02-vfs_export-do_splice_direct-to-modules.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/03-vfs_introduce-clone_private_mount.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/04-overlay-filesystem.patch.bz2%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/05-overlayfs_add-statfs-support.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/06-overlayfs_implement-show_options.patch%1
         # don't wanted feature
         #http://chakra-project.org/sources/linux/patches/3/features/overlayfs/08-fs_limit filesystem stacking depth.patch%1

         # with Jordi Pujol's overlayfs patches following:
         # for performance and improvement
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/50-copy-up-performance.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/51-improve-ovl_copy_up_xattr.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/52-vfs_getxattr-performance.patch%1
         # suppress unreliable code, it confuses /proc/mounts
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/59-read-only.patch%1
         # revert Linux 3.1 functions to 3.0
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/60-overlayfs-v10-ovl_permission.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/overlayfs/61-overlayfs-v10-ovl_dir_fsync.patch%1

         # add fedora patches
         http://chakra-project.org/sources/linux/patches/3/features/fedora/die-floppy-die.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-intel-make-lvds-work.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-nouveau-updates.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/drm-ttm-nouveau-oops-fix.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/hda_intel-prealloc-4mb-dmabuffer.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/linux-2.6-input-kill-stupid-messages.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/fedora/linux-2.6-intel-iommu-igfx.patch%1

         # add acerhk
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/01_acerhk-0.5.35.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/02_64bits_support_for_aspire5100.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/03_Add_Medion_MD97600_support.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/04_3rd-acerhk-proc_dir_entry-owner.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/05_kbuild.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/06_lindent.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/07_remove-ifdefs-for-ancient-kernels.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/08_remove-ifdefs-for-ACERDEBUG.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/09_kcompat-2.6.36.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/10_kcompat-2.6.38.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/acerhk/11_bg-flag.patch%1

         # revert rt2x00 changes
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0001-Revert-rt2x00-Add-device-ID-for-RT539F-device.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0002-Revert-rt2x00-rt2800-fix-zeroing-skb-structure.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0003-Revert-rt2x00-fix-usage-of-NULL-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0004-Revert-rt2x00-fix-order-of-entry-flags-modification.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0005-Revert-rt2x00-do-not-drop-usb-dev-reference-counter-.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0006-Revert-rt2x00-fix-crash-in-rt2800usb_write_tx_desc.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00-reverts/0007-Revert-rt2x00-fix-crash-in-rt2800usb_get_txwi.patch%1

         # add rt2x00 drivers from 3.1 tree
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0001-rt2x00-Enable-PA_PE-bits-in-TX_PIN_CFG-according-to-.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0002-rt2x00-Don-t-disable-G0-PA_PE-bit-in-case-of-BT-coex.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0003-rt2x00-Add-support-for-RT3572-RT3592-RT3592-Bluetoot.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0004-rt2x00-Interface-sequence-lock-doesn-t-have-to-disab.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0005-rt2x00-Move-rt2800_txdone-and-rt2800_txdone_entry_ch.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0006-rt2x00-Enabled-rt35xx-device-support-by-default.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0009-rt2x00-fix-possible-memory-corruption-in-case-of-inv.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0010-rt2x00-reset-usb-devices-at-probe.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0011-rt2x00-Fix-unspeficied-typo.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0012-rt2x00-Serialize-TX-operations-on-a-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0013-rt2x00-Don-t-use-queue-entry-as-parameter-when-creat.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0014-rt2x00-Reduce-window-of-a-queue-s-tx-lock.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0015-rt2x00-Add-device-ID-for-RT539F-device.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0016-rt2x00-Properly-identify-rt2800usb-devices.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0017-rt2x00-Implement-tx_frames_pending-mac80211-callback.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0018-rt2800usb-Add-new-device-ID-for-Belkin.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0019-rt2x00-rt2800-fix-zeroing-skb-structure.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0020-rt2x00-Fix-compilation-without-CONFIG_RT2X00_LIB_CRY.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0021-rt2x00-fix-usage-of-NULL-queue.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0022-rt2x00-Add-new-rt73-buffalo-USB-id.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0023-rt2x00-Add-rt2870-device-id-for-Dvico-usb-key.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0024-rt2x00-fix-crash-in-rt2800usb_write_tx_desc.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0025-rt2x00-fix-order-of-entry-flags-modification.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0026-rt2x00-fix-crash-in-rt2800usb_get_txwi.patch%1
         http://chakra-project.org/sources/linux/patches/3/features/rt2x00/0027-rt2x00-do-not-drop-usb-dev-reference-counter-on-susp.patch%1

         # stable candidate
         http://chakra-project.org/sources/linux/patches/3/candidate/0001-Patch-md-linear-avoid-corrupting-structure-while-wai.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0002-Patch-drm-radeon-kms-set-a-default-max_pixel_clock-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0003-drm-radeon-kms-make-sure-pci-max-read-request-size-i.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0004-Patch-mm-page-allocator-reconsider-zones-for-allocat.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0005-Patch-mm-page-allocator-initialise-ZLC-for-first-zon.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0006-Patch-igb-fix-WOL-on-second-port-of-i350-device-has-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0007-MXC-iomux-v3-correct-NO_PAD_CTRL-definition.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0008-Patch-x86-perf-Check-that-current-mm-is-alive-before.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0009-Patch-sched-Separate-the-scheduler-entry-for-preempt.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0010-Patch-sched-Move-blk_schedule_flush_plug-out-of-__sc.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0011-Patch-sched-Fix-a-memory-leak-in-__sdt_free-has-been.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0012-Patch-rtc-Fix-RTC-PIE-frequency-limit-has-been-added.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0013-Patch-mmc-sdhci-s3c-Fix-mmc-card-I-O-problem-has-bee.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0014-Patch-mmc-rename-mmc_host_clk_-ungate-gate-to-mmc_ho.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0015-Patch-mmc-core-use-non-reentrant-workqueue-for-clock.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0016-Patch-mmc-core-prevent-aggressive-clock-gating-racin.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0017-Patch-alarmtimers-Memset-itimerspec-passed-into-alar.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0018-Patch-alarmtimers-Avoid-possible-null-pointer-traver.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0019-Patch-alarmtimers-Avoid-possible-denial-of-service-w.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0020-Patch-xen-smp-Warn-user-why-they-keel-over-nosmp-or-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0021-Patch-md-Fix-handling-for-devices-from-2TB-to-4TB-in.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0022-Patch-media-vp7045-fix-buffer-setup-has-been-added-t.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0023-Patch-media-nuvoton-cir-simplify-raw-IR-sample-handl.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0024-Patch-hwmon-max16065-Fix-current-calculation-has-bee.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0025-Patch-drm-nouveau-properly-handle-allocation-failure.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0026-Patch-Avoid-dereferencing-a-request_queue-after-last.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0027-Patch-ARM-davinci-fix-cache-flush-build-error-has-be.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0028-Patch-ARM-davinci-da850-EVM-read-mac-address-from-SP.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0029-Patch-ARM-7081-1-mach-integrator-fix-the-clocksource.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0030-Patch-net-9p-Fix-the-msize-calculation.-has-been-add.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0031-Patch-VirtIO-can-transfer-VIRTQUEUE_NUM-of-pages.-ha.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0032-Patch-net-9p-fix-client-code-to-fail-more-gracefully.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0033-Patch-irda-fix-smsc-ircc2-section-mismatch-warning-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0034-Patch-iommu-amd-Make-sure-iommu-need_sync-contains-c.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0035-Patch-iommu-amd-Don-t-take-domain-lock-recursivly-ha.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0036-Patch-fs-9p-When-doing-inode-lookup-compare-qid-deta.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0037-Patch-fs-9p-Fix-invalid-mount-options-args-has-been-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0038-Patch-fs-9p-Fid-is-not-valid-after-a-failed-clunk.-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0039-Patch-fs-9p-Always-ask-new-inode-in-create-has-been-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0040-Patch-Fix-the-size-of-receive-buffer-packing-onto-Vi.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0041-Patch-9p-close-ACL-leaks-has-been-added-to-the-3.0-s.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0042-Patch-ACPICA-Do-not-repair-_TSS-return-package-if-_P.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0043-Patch-net-9p-Fix-kernel-crash-with-msize-512K-has-be.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0044-Patch-fs-9p-Use-protocol-defined-value-for-lock-getl.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0045-Patch-fs-9p-Don-t-update-file-type-when-updating-fil.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0046-Patch-fs-9p-Always-ask-new-inode-in-lookup-for-cache.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0047-Patch-fs-9p-Add-fid-before-dentry-instantiation-has-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0048-Patch-PCI-Set-PCI-E-Max-Payload-Size-on-fabric-has-b.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0049-Patch-PCI-Remove-MRRS-modification-from-MPS-setting-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0050-Patch-PCI-export-pcie_bus_configure_settings-symbol-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0051-Patch-fs-9p-Add-OS-dependent-open-flags-in-9p-protoc.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0052-Patch-SCSI-isci-fix-sata-response-handling-has-been-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0053-Patch-x86-iommu-Mark-DMAR-IRQ-as-non-threaded-has-be.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0054-Patch-rtlwifi-rtl8192su-Fix-problem-connecting-to-HT.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0055-Patch-rtlwifi-Fix-problem-when-switching-connections.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0056-Patch-mfd-Make-omap-usb-host-TLL-mode-work-again-has.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0057-Patch-mfd-Fix-value-of-WM8994_CONFIGURE_GPIO-has-bee.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0058-Patch-mfd-Fix-initialisation-of-tps65910-interrupts-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0059-Patch-mac80211-fix-missing-sta_lock-in-__sta_info_de.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0060-Patch-iwlegacy-fix-BUG_ON-info-control.rates-0-.idx-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0061-Patch-SCSI-isci-fix-32-bit-operation-when-CONFIG_HIG.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0062-Patch-SCSI-hpsa-fix-problem-that-OBDR-devices-are-no.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0063-Patch-SCSI-hpsa-fix-physical-device-lun-and-target-n.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0064-Patch-genirq-Make-irq_shutdown-symmetric-vs.-irq_sta.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0065-Patch-e1000-Fix-driver-to-be-used-on-PA-RISC-C8000-w.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0066-Patch-ath9k_hw-fix-calibration-on-5-ghz-has-been-add.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0067-Patch-ASoC-MPC5200-replace-of_device-with-platform_d.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0068-Patch-ASoC-Fix-reporting-of-partial-jack-updates-has.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0069-Patch-ASoC-Blackfin-bf5xx-ad193x-Fix-codec-device-na.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0070-Patch-acpica-ACPI_MAX_SLEEP-should-be-2-sec-not-20-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0071-Patch-vfs-automount-should-ignore-LOOKUP_FOLLOW-has-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0072-Patch-workqueue-lock-cwq-access-in-drain_workqueue-h.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0073-Patch-USB-xhci-Set-change-bit-when-warm-reset-change.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0074-Patch-restore-pinning-the-victim-dentry-in-vfs_rmdir.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0075-Patch-mm-sync-vmalloc-address-space-page-tables-in-a.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0076-Patch-ibmveth-Fix-issue-with-DMA-mapping-failure-has.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0077-Patch-ibmveth-Fix-DMA-unmap-error-has-been-added-to-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0078-Patch-ibmveth-Checksum-offload-is-always-disabled-ha.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0079-Patch-firewire-ohci-add-no-MSI-quirk-for-O2Micro-con.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0080-drm-radeon-kms-Make-GPU-CPU-page-size-handling-consi.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0081-drm-radeon-Don-t-read-from-CP-ring-write-pointer-reg.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0082-drm-radeon-kms-fix-typo-in-r100_blit_copy.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0083-Patch-drivers-leds-ledtrig-timer.c-fix-broken-sysfs-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0084-Patch-drivers-cpufreq-pcc-cpufreq.c-avoid-NULL-point.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0085-Patch-ALSA-pcm-fix-race-condition-in-wait_for_avail-.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0086-Patch-ALSA-HDA-Cirrus-fix-Surround-Speaker-volume-co.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0087-Patch-iwlagn-fix-command-queue-timeout-has-been-adde.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0088-Patch-cifs-fix-possible-memory-corruption-in-CIFSFin.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0089-Patch-Fix-the-conflict-between-rwpidforward-and-rw-m.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0090-Patch-ALSA-hda-realtek-Fix-auto-mute-with-HP-LO-conf.patch%1
         http://chakra-project.org/sources/linux/patches/3/candidate/0091-Patch-ARM-Dove-fix-second-SPI-initialization-call-ha.patch%1

        )
# Name of the resulting patch (will be bzipped afterwards)
PATCHNAME="patch-3.0.4-2-CHAKRA"

# Run this before applying patches
pre_apply() {
  :
}

# Run this after applying patches
post_apply() {
  # remove the sublevel and extraversion from Makefile
  # this ensures our kernel version is always 3.X-CHAKRA
  # this way, minor kernel updates will not break external modules
  sed -i 's|^SUBLEVEL = .*$|SUBLEVEL = |g' Makefile
  sed -i 's|^EXTRAVERSION = .*$|EXTRAVERSION = |g' Makefile

  # Kill some files
  find . -name '*~' -exec rm -f {} \; 2>/dev/null
}
