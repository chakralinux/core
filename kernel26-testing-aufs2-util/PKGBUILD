#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=kernel26-testing-aufs2-util
pkgver=20100809
pkgrel=1
pkgdesc="Another Unionfs Implementation that supports NFS branches"
arch=('i686' 'x86_64')
url="http://aufs.sourceforge.net/"
license=('GPL2')
depends=('glibc')
makedepends=('kernel26-testing-aufs2>=2.6.35_20100809' 'kernel26-testing-headers')
replaces=('aufs-utils' 'aufs2-util')
conflicts=('aufs2-util')
source=(http://chakra-project.org/sources/aufs2-util/aufs2-util-$pkgver.tar.gz)
md5sums=('28abec237a2d0b3307e319e13bfdb9e4')

build() {
  cd $srcdir/aufs2-util-$pkgver || return 1
  # fix KDIR
  sed -i 's|$(shell uname -r)|2.6.35-CHAKRA|g' ./Makefile
  
  # build
  make || return 1
  # install
  #mkdir -p $pkgdir/{sbin,usr/bin,etc/default/aufs}
  make DESTDIR=$pkgdir install || return 1
  rm $pkgdir/usr/lib/libau.so.2
  rm $pkgdir/usr/lib/libau.so
  ln -sf libau.so.2.2 $pkgdir/usr/lib/libau.so.2
  ln -sf libau.so.2.2 $pkgdir/usr/lib/libau.so
}
