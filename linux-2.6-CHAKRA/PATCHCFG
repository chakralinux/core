# Kernel source file
SRC="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-2.6.37.tar.bz2"
# Original source directory
SRCORIG="linux-2.6.37"
# Our source directory
SRCNAME="linux-2.6.37-CHAKRA"
# Patches:
#   URL%patchlevel
#  or
#   filename%patchlevel (file must be in patches subdirectory)
PATCHES=(
         # add upstream patch from 2.6.37 series
         http://www.kernel.org/pub/linux/kernel/v2.6/patch-2.6.37.4.bz2%1

         # add latest fixes from stable queue, if needed
         # http://git.kernel.org/?p=linux/kernel/git/stable/stable-queue.git

         # add aufs2 support, in reference to:
         # http://aufs.sourceforge.net
         http://chakra-project.org/sources/kernel26/patches/37/aufs2.1/aufs2-kbuild-37.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/aufs2.1/aufs2-base-37.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/aufs2.1/aufs2-standalone-37.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/aufs2.1/aufs2.1-standalone.tree-37-20110307.patch.bz2%1
         # squashfs with lzma
         http://chakra-project.org/sources/kernel26/patches/37/squashfs-lzma/01-squashfs_revert_to_2.6.35.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/squashfs-lzma/02-squashfs_add_lzma.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/squashfs-lzma/03-squashfs_make_lzma_available.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/squashfs-lzma/04-decompress_unlzo_fix.patch%1
         http://chakra-project.org/sources/kernel26/patches/37/squashfs-lzma/05-fix_building_squashfs_with_xattrs.patch%1
         # sched_autogroup
         http://chakra-project.org/sources/kernel26/patches/37/autogroup/kernel2.6.37.1-cgroup.patch%1

        )
# Name of the resulting patch (will be bzipped afterwards)
PATCHNAME="patch-2.6.37.4-1-CHAKRA"

# Run this before applying patches
pre_apply() {
  :
}

# Run this after applying patches
post_apply() {
  # remove the extraversion from Makefile
  # this ensures our kernel version is always 2.6.XX-CHAKRA
  # this way, minor kernel updates will not break external modules
  sed -i 's|^EXTRAVERSION = .*$|EXTRAVERSION = |g' Makefile

  # Kill some files
  find . -name '*~' -exec rm -f {} \; 2>/dev/null
}
