#
# QT Packages for Chakra, part of chakra-project.org
#
# maintainer abveritas@chakra-project.org

pkgname=qtwebkit
pkgver=2.2.2
pkgrel=1
arch=('x86_64')
url='http://trac.webkit.org/wiki/QtWebKit'
pkgdesc='An open source web browser engine (Qt port)'
license=('LGPL2.1' 'GPL3')
depends=('qt' 'gstreamer0.10' 'gstreamer0.10-base' 'gstreamer0.10-base-plugins'
         'gstreamer0.10-good-plugins' 'gstreamer0.10-bad-plugins' 'gstreamer0.10-ffmpeg'
         'gstreamer0.10-ugly-plugins')
makedepends=('gperf' 'sqlite3' 'fontconfig' 'perl' 'python2' 'mesa' 'ruby')
source=("${pkgname}-${pkgver}-source.tar.gz"
        'glib.patch')
sha1sums=('914d7cc099e5b6181c2d74fc7a74e1b4478b75a4'
          'dff60039b212c2f53a7b425dfcf6af78e09a80af')

build() {
  cd "${srcdir}"/${pkgname}-${pkgver}-source

  patch -p1 -i "${srcdir}"/glib.patch

  # move headers
  mv include Source/

  cd Source
  qmake
  cd ../

  make -C Source

  # Build the QWebView plugin (FS#27914)
  #cd "${srcdir}"/${pkgname}-${pkgver}-source/qwebview-${_qtver}/plugins/qwebview
  #qmake
  #make
}

package() {
  cd "${srcdir}"/${pkgname}-${pkgver}-source
  make INSTALL_ROOT="${pkgdir}" -C Source install

  # Fix RPATH
  #chrpath -r /usr/lib/ "${pkgdir}"/usr/lib/qt/imports/QtWebKit/libqmlwebkitplugin.so

  #cd "${srcdir}"/${pkgname}-${pkgver}-source/qwebview-${_qtver}/plugins/qwebview
  #make INSTALL_ROOT="${pkgdir}" install
}
