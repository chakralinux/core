#
# QT Packages for Chakra, part of chakra-project.org
#
# maintainer abveritas@chakra-project.org

pkgname=qtwebkit
pkgver=20121101
pkgrel=1
_rev=r124698
arch=('i686' 'x86_64')
url='http://trac.webkit.org/wiki/QtWebKit'
pkgdesc='An open source web browser engine (Qt port)'
license=('LGPL2.1' 'GPL3')
depends=('qt' 'gstreamer0.10' 'gstreamer0.10-base' 'gstreamer0.10-base-plugins' 'gstreamer0.10-good-plugins' 'gstreamer0.10-bad-plugins' 'gstreamer0.10-ffmpeg' 'gstreamer0.10-ugly-plugins')
makedepends=('gperf' 'sqlite3' 'fontconfig' 'perl' 'python2' 'mesa' 'ruby')
conflicts=('qt<4.8')

#source=("http://builds.nightly.webkit.org/files/trunk/src/WebKit-${_rev}.tar.bz2"
#        "http://chakra-linux.org/sources/$pkgname/qwebview-4.8.2.tar.xz")
#sha1sums=('49d0427370553c5af3160d27c9aac08a66b4ad78'
#          '33c83272ed8110180ee6e7e3733e68cc513e2802')

_gitroot="git://gitorious.org/+qtwebkit-developers/webkit/qtwebkit-23.git"
_gitname=qtwebkit-23

build() {
	if [ ! -d "${_gitname}" ]; then
		git clone --branch=qtwebkit-2.3-staging ${_gitroot} ${_gitname} && cd ${_gitname}
	else
		cd ${_gitname} && git reset --hard && git pull origin && git clean -dfx
	fi

	msg "GIT checkout done."
	
        export QTDIR=$srcdir/$pkgname
        export PATH=${QTDIR}/bin:${PATH}
        QMAKEPATH=$WEBKITDIR/Tools/qmake
        Tools/Scripts/build-webkit --qt --makeargs="${MAKEFLAGS}" 
#	Tools/Scripts/build-webkit --qt --qmake=Tools/qmake --release
}

package() {
	cd "${_gitname}"

	make INSTALL_ROOT="${pkgdir}" -C WebKitBuild/Release install
}
